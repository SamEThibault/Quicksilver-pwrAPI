<System>
    <!-- This is how you include plugins. Pretty sure you can have multiple. -->
    <Plugins>
        <plugin name="PowerMetrics" lib="libpwr_powermetrics"/>
    </Plugins>
    <!-- This bit runs the initialization process for the plugin, with a given init string.
    My plugin doesn't use one, but others probably do. -->
    <Devices>
        <device name="PowerMetrics-core" plugin="PowerMetrics" initString=""/>
    </Devices>
    <!-- This does something. I don't know but it doesn't work without it. It's probably the port to run Power API on. -->
    <Locations>
        <location name="daemon-cab0" type="rpc" config="localhost:32000" />
    </Locations>
    <!-- This is the stuff that's partly autogenerated by pwrgen, but heavily modified. -->
    <Objects>
        <!-- This is an object.
        This one is a platform, which any/all nodes are built off of.
        The children tag specifies the nodes, in this case just one. -->
        <obj name="plat" type="Platform">
            <!-- All objects have attributes, and this is the syntax for specifying them.
            The PowerMetrics plugin doesn't support Platforms, and the program never calls from the platform context,
            so this specific property might not even work idk. -->
            <attributes>
                <attr name="POWER" op="SUM">
                    <src type="child" name="node" />
                </attr>
            </attributes>
            <children>
                <child name="node0"/>
            </children>
            </obj>
        <!-- This is the target node. If we create a file for the whole CAC, it'll need like a hundred of these.
        However, if it's just for one elevated node, we can use pwrgen to get a basic layout of the specs
        and define details from there. -->
        <obj name="plat.node0" type="Node">
            <!-- This is how you include a plugin in a specific object.
            It will call the open function in the plugin with the specified openString -->
            <devices>
                <dev name="dev1" device="PowerMetrics-core" openString="node0" /> 
                </devices>
            <!-- define all the attributes you want and which plugin will provide them.
            In this case every node and core uses 'dev1' because the PowerMetrics plugin supports that. -->
            <attributes>
                <attr name="POWER" op="SUM" >
                    <src type="device" name="dev1" />
                </attr>
                <attr name="FREQ" op="SUM" >
                    <src type="device" name="dev1" />
                </attr>
            </attributes>
            <children>
                <child name="core0"/>
                <child name="core1"/>
                <child name="core2"/>
                <child name="core3"/>
                <child name="core4"/>
                <child name="core5"/>
            </children>
            </obj>
        <!-- So, different capabilities will exist for the node and core levels.
        For example, only total package power is available on Mac, so POWER is a node-only property.
        For cores, each individual core has it's own C-State residency, so that's only a core property.
        Each core is basically identical, just with a different opening string to read accurate data. -->
        <obj name="plat.node0.core0" type="Core">
            <devices>
                <dev name="dev1" device="PowerMetrics-core" openString="core0" /> 
            </devices>
            <attributes>
                <attr name="CSTATE" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
                <attr name="FREQ" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
            </attributes>
        </obj>
        <obj name="plat.node0.core1" type="Core">
            <devices>
                <dev name="dev1" device="PowerMetrics-core" openString="core1" /> 
            </devices>
            <attributes>
                <attr name="CSTATE" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
                <attr name="FREQ" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
            </attributes>
        </obj>
        <obj name="plat.node0.core2" type="Core">
            <devices>
                <dev name="dev1" device="PowerMetrics-core" openString="core2" /> 
            </devices>
            <attributes>
                <attr name="CSTATE" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
                <attr name="FREQ" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
            </attributes>
        </obj>
        <obj name="plat.node0.core3" type="Core">
            <devices>
                <dev name="dev1" device="PowerMetrics-core" openString="core3" /> 
            </devices>
            <attributes>
                <attr name="CSTATE" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
                <attr name="FREQ" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
            </attributes>
        </obj>
        <obj name="plat.node0.core4" type="Core">
            <devices>
                <dev name="dev1" device="PowerMetrics-core" openString="core4" /> 
            </devices>
            <attributes>
                <attr name="CSTATE" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
                <attr name="FREQ" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
            </attributes>
        </obj>
        <obj name="plat.node0.core5" type="Core">
            <devices>
                <dev name="dev1" device="PowerMetrics-core" openString="core5" /> 
            </devices>
            <attributes>
                <attr name="CSTATE" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
                <attr name="FREQ" op="SUM">
                    <src type="device" name="dev1" />
                </attr>
            </attributes>
        </obj>
    </Objects>
</System>
